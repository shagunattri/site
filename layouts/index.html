{{ define "body" }}
    <body class="homepage-body {{ if .Site.Params.backgroundImage }} background-image" style="background-image: url('{{ .Site.Params.backgroundImage }}');" {{ else }}"{{ end }}>
{{ end }}

{{ define "main" }}
<main aria-role="main" class="homepage-v2">
    <!-- Animated background elements -->
    <div class="bg-gradient-orbs">
        <div class="orb orb-1"></div>
        <div class="orb orb-2"></div>
        <div class="orb orb-3"></div>
    </div>

    <!-- Hero Section -->
    <section class="hero-section">
        <div class="hero-container hero-centered">
            <div class="hero-visual animate-float">
                <div class="visual-card main-card">
                    {{ if .Site.Params.Portrait.Path }}
                        {{ $p_src := index (last 1 (split .Site.Params.Portrait.Path "/")) 0 }}
                        {{ partial "responsive-img.html" (dict "src" $p_src "alt" (.Site.Params.Portrait.Alt | default .Site.Author.name) "class" "profile-image" "loading" "eager") }}
                    {{ end }}
                    <div class="card-glow"></div>
                </div>
                <div class="floating-badge badge-security">
                    <svg class="badge-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg> ASPM
                </div>
                <div class="floating-badge badge-product">
                    <svg class="badge-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg> RBVM
                </div>
                <div class="floating-badge badge-ai">
                    <svg class="badge-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/></svg> Cloud Security
                </div>
                <div class="floating-badge badge-pm">
                    <svg class="badge-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"/><rect x="8" y="2" width="8" height="4" rx="1" ry="1"/></svg> Exposure Management
                </div>
                <div class="floating-badge badge-aspm">
                    <svg class="badge-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2L2 7l10 5 10-5-10-5z"/><path d="M2 17l10 5 10-5"/><path d="M2 12l10 5 10-5"/></svg> Supply Chain Security
                </div>
                <div class="floating-badge badge-extra1">
                    <svg class="badge-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="16 18 22 12 16 6"/><polyline points="8 6 2 12 8 18"/></svg> DevSecOps
                </div>
                <div class="floating-badge badge-extra2">
                    <svg class="badge-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="7" width="20" height="14" rx="2" ry="2"/><path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"/></svg> Product Management
                </div>
            </div>

            <div class="hero-content">
                <div class="hero-badge animate-fade-in">
                    <span class="badge-dot"></span>
                    <span>Hey, I'm Shagun üëã</span>
                </div>
                
                <h1 class="hero-title animate-slide-up">
                    <span class="title-line">Building</span>
                    <span class="title-line accent">Secure Products</span>
                    <span class="title-line">That Scale</span>
                </h1>
                
                <p class="hero-description animate-slide-up delay-1">
                    Senior Product Manager crafting AI-powered cybersecurity solutions. 
                    I help organizations ship software <em>fast</em> and ship it <em>securely</em>.
                </p>
                
                <div class="hero-cta animate-slide-up delay-2">
                    <a href="/about/" class="btn-primary">
                        <span>About Me</span>
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M5 12h14M12 5l7 7-7 7"/>
                        </svg>
                    </a>
                    <a href="/projects/" class="btn-secondary">
                        <span>View Projects</span>
                    </a>
                </div>
                </div>

            </div>
        </div>
    </section>

    <!-- Focus Areas - Bento Grid -->
    <section class="bento-section">
        <div class="section-container">
            <div class="section-header animate-on-scroll">
                <span class="section-tag">What I Do</span>
                <h2 class="section-title">Key Focus Areas</h2>
            </div>

            <div class="bento-grid">
                <a href="{{ "/categories/security/" | relURL }}" class="bento-card bento-large animate-on-scroll">
                    <div class="bento-icon"><svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg></div>
                    <h3>Cybersecurity</h3>
                    <p>Building AI-powered Application Security Posture Management (ASPM) and Risk-Based Vulnerability Management (RBVM) solutions.</p>
                    <div class="bento-tags">
                        <span>ASPM</span>
                        <span>DevSecOps</span>
                        <span>RBVM</span>
                    </div>
                    <div class="bento-arrow">‚Üí</div>
                </a>

                <a href="{{ "/categories/startups/" | relURL }}" class="bento-card bento-medium animate-on-scroll">
                    <div class="bento-icon"><svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="7" width="20" height="14" rx="2" ry="2"/><path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"/></svg></div>
                    <h3>Product Management</h3>
                    <p>Driving product strategy, roadmaps, and execution for B2B SaaS platforms.</p>
                    <div class="bento-arrow">‚Üí</div>
                </a>

                <a href="{{ "/categories/dev/" | relURL }}" class="bento-card bento-medium animate-on-scroll">
                    <div class="bento-icon"><svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="16 18 22 12 16 6"/><polyline points="8 6 2 12 8 18"/></svg></div>
                    <h3>Tech & Development</h3>
                    <p>Linux, Docker, Git, and automation. Building efficient developer workflows.</p>
                    <div class="bento-arrow">‚Üí</div>
                </a>

                <a href="/blog/" class="bento-card bento-full animate-on-scroll">
                    <div class="bento-icon"><svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"/></svg></div>
                    <h3>Writing & Insights</h3>
                    <p>Sharing perspectives on cybersecurity, startups, and technology through blog posts and guides.</p>
                    <div class="bento-arrow">‚Üí</div>
                </a>
            </div>
        </div>
    </section>

    <!-- Featured Projects Section -->
    <section class="featured-projects-section">
        <div class="section-container">
            <div class="section-header animate-on-scroll">
                <span class="section-tag">Showcase</span>
                <h2 class="section-title">Featured Projects</h2>
            </div>

            <div class="featured-projects-grid">
                {{ $projectSection := .Site.GetPage "section" "projects" }}
                {{ $featuredProjects := where $projectSection.Pages ".Params.featured" true }}
                {{ $featuredProjects = where $featuredProjects ".Draft" "!=" true }}
                {{ range $i, $project := ($featuredProjects.ByDate.Reverse) }}
                    <a href="{{ with .Params.external_url }}{{ . }}{{ else }}{{ .Permalink }}{{ end }}" class="featured-project-card animate-on-scroll" {{ with .Params.external_url }}target="_blank" rel="noopener"{{ end }}>
                        {{ if .Params.thumbnail }}
                        <div class="featured-project-thumb">
                            {{ $thumb_src := index (last 1 (split .Params.thumbnail "/")) 0 }}
                            {{ partial "responsive-img.html" (dict "src" $thumb_src "alt" .Title "class" "" "loading" "lazy") }}
                        </div>
                        {{ else }}
                        <div class="featured-project-thumb featured-project-thumb-placeholder">
                            <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><rect x="2" y="3" width="20" height="14" rx="2"/><path d="M8 21h8M12 17v4"/></svg>
                        </div>
                        {{ end }}
                        <div class="featured-project-info">
                            <h3 class="featured-project-title">{{ .Title }}</h3>
                            <p class="featured-project-summary">{{ .Params.summary }}</p>
                            <span class="featured-project-link">
                                View Project
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M5 12h14M12 5l7 7-7 7"/></svg>
                            </span>
                        </div>
                    </a>
                {{ end }}
            </div>

            <div class="posts-cta animate-on-scroll">
                <a href="/projects/" class="btn-outline">
                    View all projects
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M5 12h14M12 5l7 7-7 7"/>
                    </svg>
                </a>
            </div>
        </div>
    </section>

    <!-- Recent Posts Section -->
    <section class="posts-section">
        <div class="section-container">
            <div class="section-header animate-on-scroll">
                <span class="section-tag">Latest</span>
                <h2 class="section-title">Recent Blogs</h2>
            </div>

            <div class="posts-grid">
                {{ $blogPosts := where .Site.RegularPages "Section" "blog" }}
                {{ $blogPosts = where $blogPosts ".Params.unlisted" "!=" true }}
                {{ range $i, $post := first 4 ($blogPosts.ByDate.Reverse) }}
                    <a href="{{ .Permalink }}" class="post-card animate-on-scroll" style="--delay: {{ $i }}">
                        <div class="post-meta">
                            <span class="post-date">{{ .Date.Format $.Site.Params.dateformShort }}</span>
                            {{ with .Params.categories }}
                                <span class="post-category">{{ index . 0 }}</span>
                            {{ end }}
                        </div>
                        <h3 class="post-title">{{ .Title }}</h3>
                        <p class="post-excerpt">{{ .Summary | plainify | truncate 100 }}</p>
                        <span class="post-link">
                            Read blog
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M5 12h14M12 5l7 7-7 7"/>
                            </svg>
                        </span>
                    </a>
                {{ end }}
            </div>

            <div class="posts-cta animate-on-scroll">
                <a href="/blog/" class="btn-outline">
                    View all posts
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M5 12h14M12 5l7 7-7 7"/>
                    </svg>
                </a>
            </div>
        </div>
    </section>

    <!-- Projects + Activity Section -->
    <section class="projects-activity-section">
        <div class="section-container">
            <div class="projects-activity-columns">
                <!-- Left Column: Projects Timeline -->
                <div class="projects-timeline-column">
                    <div class="section-header-inline animate-on-scroll">
                        <h2 class="section-title-sm">Projects</h2>
                        <a href="/projects/" class="view-all-link">View all ‚Üí</a>
                    </div>

                    <div class="project-timeline">
                        {{ $allProjects := where $projectSection.Pages ".Draft" "!=" true }}
                        {{ $allProjects = where $allProjects "Kind" "page" }}
                        {{ range $i, $project := ($allProjects.ByDate.Reverse) }}
                        <a href="{{ with .Params.external_url }}{{ . }}{{ else }}{{ .Permalink }}{{ end }}" class="timeline-item animate-on-scroll" {{ with .Params.external_url }}target="_blank" rel="noopener"{{ end }}>
                            <div class="timeline-dot"></div>
                            <div class="timeline-content">
                                <h4 class="timeline-title">{{ .Title }}</h4>
                                <div class="timeline-meta">
                                    <span class="timeline-date">{{ .Date.Format "Jan 2006" }}</span>
                                </div>
                            </div>
                        </a>
                        {{ end }}
                    </div>
                </div>

                <!-- Middle Column: Books Timeline -->
                <div class="books-timeline-column">
                    <div class="section-header-inline animate-on-scroll">
                        <h2 class="section-title-sm">Books</h2>
                        <a href="/blog/bookshelf/" class="view-all-link">Bookshelf ‚Üí</a>
                    </div>

                    <div class="project-timeline books-timeline">
                        <a href="https://www.goodreads.com/book/show/9809.Invisible_Cities" class="timeline-item animate-on-scroll" target="_blank" rel="noopener">
                            <div class="timeline-dot books-dot"></div>
                            <div class="timeline-content">
                                <h4 class="timeline-title">Love in the Time of Cholera</h4>
                                <div class="timeline-meta">
                                    <span class="timeline-author">Gabriel Garc√≠a M√°rquez</span>
                                    <span class="timeline-rating">‚≠ê‚≠ê‚≠ê</span>
                                </div>
                            </div>
                        </a>
                        <a href="https://www.goodreads.com/book/show/9809.Invisible_Cities" class="timeline-item animate-on-scroll" target="_blank" rel="noopener">
                            <div class="timeline-dot books-dot"></div>
                            <div class="timeline-content">
                                <h4 class="timeline-title">Invisible Cities</h4>
                                <div class="timeline-meta">
                                    <span class="timeline-author">Italo Calvino</span>
                                </div>
                            </div>
                        </a>
                        <a href="https://www.goodreads.com/book/show/328802.Totto_chan" class="timeline-item animate-on-scroll" target="_blank" rel="noopener">
                            <div class="timeline-dot books-dot"></div>
                            <div class="timeline-content">
                                <h4 class="timeline-title">Totochan</h4>
                                <div class="timeline-meta">
                                    <span class="timeline-author">Tetsuko Kuroyanagi</span>
                                    <span class="timeline-rating">‚≠ê‚≠ê‚≠ê‚≠ê</span>
                                </div>
                            </div>
                        </a>
                        <a href="https://www.goodreads.com/book/show/62910347-don-t-shut-up" class="timeline-item animate-on-scroll" target="_blank" rel="noopener">
                            <div class="timeline-dot books-dot"></div>
                            <div class="timeline-content">
                                <h4 class="timeline-title">Don't Shut Up!</h4>
                                <div class="timeline-meta">
                                    <span class="timeline-author">Prakhar Gupta</span>
                                    <span class="timeline-rating">‚≠ê‚≠ê‚≠ê</span>
                                </div>
                            </div>
                        </a>
                        <a href="https://www.goodreads.com/book/show/40745.Mindset" class="timeline-item animate-on-scroll" target="_blank" rel="noopener">
                            <div class="timeline-dot books-dot"></div>
                            <div class="timeline-content">
                                <h4 class="timeline-title">Mindset</h4>
                                <div class="timeline-meta">
                                    <span class="timeline-author">Dr. Carol S. Dweck</span>
                                    <span class="timeline-rating">‚≠ê‚≠ê</span>
                                </div>
                            </div>
                        </a>
                        <a href="https://www.goodreads.com/book/show/18050143-zero-to-one" class="timeline-item animate-on-scroll" target="_blank" rel="noopener">
                            <div class="timeline-dot books-dot"></div>
                            <div class="timeline-content">
                                <h4 class="timeline-title">Zero to One</h4>
                                <div class="timeline-meta">
                                    <span class="timeline-author">Peter Thiel</span>
                                    <span class="timeline-rating">‚≠ê‚≠ê‚≠ê‚≠ê</span>
                                </div>
                            </div>
                        </a>
                        <a href="https://www.goodreads.com/book/show/76865.Good_to_Great" class="timeline-item animate-on-scroll" target="_blank" rel="noopener">
                            <div class="timeline-dot books-dot"></div>
                            <div class="timeline-content">
                                <h4 class="timeline-title">Good to Great</h4>
                                <div class="timeline-meta">
                                    <span class="timeline-author">Jim Collins</span>
                                    <span class="timeline-rating">‚≠ê‚≠ê‚≠ê</span>
                                </div>
                            </div>
                        </a>
                        <a href="https://www.goodreads.com/book/show/53138083-working-backwards" class="timeline-item animate-on-scroll" target="_blank" rel="noopener">
                            <div class="timeline-dot books-dot"></div>
                            <div class="timeline-content">
                                <h4 class="timeline-title">Working Backwards</h4>
                                <div class="timeline-meta">
                                    <span class="timeline-author">Colin Bryar &amp; Bill Carr</span>
                                    <span class="timeline-rating">‚≠ê‚≠ê‚≠ê‚≠ê</span>
                                </div>
                            </div>
                        </a>
                        <a href="https://www.goodreads.com/book/show/40745.Mindset" class="timeline-item animate-on-scroll" target="_blank" rel="noopener">
                            <div class="timeline-dot books-dot"></div>
                            <div class="timeline-content">
                                <h4 class="timeline-title">Midnight Machines</h4>
                                <div class="timeline-meta">
                                    <span class="timeline-author">Arun Mohan Sukumar</span>
                                    <span class="timeline-rating">‚≠ê‚≠ê‚≠ê</span>
                                </div>
                            </div>
                        </a>
                        <a href="https://www.goodreads.com/book/show/30835567-hit-refresh" class="timeline-item animate-on-scroll" target="_blank" rel="noopener">
                            <div class="timeline-dot books-dot"></div>
                            <div class="timeline-content">
                                <h4 class="timeline-title">Hit Refresh</h4>
                                <div class="timeline-meta">
                                    <span class="timeline-author">Satya Nadella</span>
                                    <span class="timeline-rating">‚≠ê‚≠ê‚≠ê‚≠ê</span>
                                </div>
                            </div>
                        </a>
                        <a href="https://www.flipkart.com/two-billion-heartbeats/p/itm0ede351e555fa" class="timeline-item animate-on-scroll" target="_blank" rel="noopener">
                            <div class="timeline-dot books-dot"></div>
                            <div class="timeline-content">
                                <h4 class="timeline-title">Two Billion Heart Beats</h4>
                                <div class="timeline-meta">
                                    <span class="timeline-author">MN Raju</span>
                                    <span class="timeline-rating">‚≠ê‚≠ê‚≠ê‚≠ê</span>
                                </div>
                            </div>
                        </a>
                        <a href="https://www.goodreads.com/book/show/30817225-everyone-has-a-story" class="timeline-item animate-on-scroll" target="_blank" rel="noopener">
                            <div class="timeline-dot books-dot"></div>
                            <div class="timeline-content">
                                <h4 class="timeline-title">Everyone Has a Story</h4>
                                <div class="timeline-meta">
                                    <span class="timeline-author">Savi Sharma</span>
                                    <span class="timeline-rating">‚≠ê‚≠ê‚≠ê</span>
                                </div>
                            </div>
                        </a>
                    </div>
                </div>

                <!-- Right Column: GitHub Activity -->
                <div class="github-activity-column">
                    <div class="section-header-inline animate-on-scroll">
                        <h2 class="section-title-sm">Activity</h2>
                        <a href="https://github.com/shagunattri" class="view-all-link" target="_blank" rel="noopener">GitHub ‚Üí</a>
                    </div>

                    <div id="github-activity-feed" class="github-activity-feed">
                        <div class="activity-loading">
                            <div class="loading-spinner"></div>
                            <span>Loading activity...</span>
                        </div>
                    </div>

                    <div class="contribution-section animate-on-scroll">
                        <div id="contribution-chart" class="contribution-chart">
                            <div class="activity-loading">
                                <div class="loading-spinner"></div>
                                <span>Loading contributions...</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

</main>

<script>
// Animate numbers on scroll
function animateNumbers() {
    const numbers = document.querySelectorAll('.stat-number[data-target]');
    numbers.forEach(num => {
        const target = parseInt(num.dataset.target);
        const duration = 2000;
        const step = target / (duration / 16);
        let current = 0;
        
        const updateNumber = () => {
            current += step;
            if (current < target) {
                num.textContent = Math.floor(current);
                requestAnimationFrame(updateNumber);
            } else {
                num.textContent = target;
            }
        };
        updateNumber();
    });
}

// Intersection Observer for scroll animations
function initScrollAnimations() {
    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                entry.target.classList.add('animate-visible');
            }
        });
    }, { threshold: 0.1, rootMargin: '0px 0px -50px 0px' });

    document.querySelectorAll('.animate-on-scroll').forEach(el => {
        observer.observe(el);
    });
}

// ============================================
// GITHUB ACTIVITY FEED
// ============================================
function relativeTime(dateStr) {
    const now = new Date();
    const date = new Date(dateStr);
    const seconds = Math.floor((now - date) / 1000);
    if (seconds < 60) return 'just now';
    const minutes = Math.floor(seconds / 60);
    if (minutes < 60) return minutes + 'm ago';
    const hours = Math.floor(minutes / 60);
    if (hours < 24) return hours + 'h ago';
    const days = Math.floor(hours / 24);
    if (days === 1) return '1 day ago';
    if (days < 30) return days + ' days ago';
    const months = Math.floor(days / 30);
    return months + (months === 1 ? ' month ago' : ' months ago');
}

async function loadGitHubActivity() {
    const feedEl = document.getElementById('github-activity-feed');
    try {
        const res = await fetch('https://api.github.com/users/shagunattri/events/public?per_page=30');
        if (!res.ok) throw new Error('GitHub API error');
        const events = await res.json();

        // Filter to PushEvents and get unique repos (max 5)
        const seen = new Set();
        const pushEvents = [];
        for (const ev of events) {
            if (ev.type === 'PushEvent' && !seen.has(ev.repo.name)) {
                seen.add(ev.repo.name);
                pushEvents.push(ev);
                if (pushEvents.length >= 5) break;
            }
        }

        if (pushEvents.length === 0) {
            feedEl.innerHTML = '<p class="activity-empty">No recent activity</p>';
            return;
        }

        feedEl.innerHTML = pushEvents.map(ev => {
            const repoName = ev.repo.name.split('/').pop();
            const commit = ev.payload.commits && ev.payload.commits.length > 0
                ? ev.payload.commits[ev.payload.commits.length - 1]
                : null;
            const commitMsg = commit ? commit.message.split('\n')[0] : '';
            const repoUrl = 'https://github.com/' + ev.repo.name;
            return `
                <a href="${repoUrl}" class="activity-item" target="_blank" rel="noopener">
                    <div class="activity-item-header">
                        <span class="activity-repo-name">${repoName}</span>
                        <span class="activity-time">${relativeTime(ev.created_at)}</span>
                    </div>
                    ${commitMsg ? `<div class="activity-commit"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="16 18 22 12 16 6"/><polyline points="8 6 2 12 8 18"/></svg> ${commitMsg}</div>` : ''}
                </a>
            `;
        }).join('');

    } catch (err) {
        feedEl.innerHTML = '<p class="activity-empty">Unable to load activity. <a href="https://github.com/shagunattri" target="_blank">View on GitHub ‚Üí</a></p>';
    }
}

// ============================================
// MONTHLY CONTRIBUTION CHART (Current Month)
// ============================================
async function loadContributionChart() {
    const chartEl = document.getElementById('contribution-chart');
    const now = new Date();
    const year = now.getFullYear();
    const month = now.getMonth(); // 0-indexed
    const daysInMonth = new Date(year, month + 1, 0).getDate();
    const monthName = now.toLocaleString('default', { month: 'long' });

    try {
        // Fetch multiple pages of events to cover the month
        const allEvents = [];
        for (let page = 1; page <= 3; page++) {
            const res = await fetch(`https://api.github.com/users/shagunattri/events/public?per_page=100&page=${page}`);
            if (!res.ok) break;
            const events = await res.json();
            if (events.length === 0) break;
            allEvents.push(...events);
        }

        // Count contributions per day in the current month
        const dayCounts = {};
        for (let d = 1; d <= daysInMonth; d++) {
            dayCounts[d] = 0;
        }

        for (const ev of allEvents) {
            const evDate = new Date(ev.created_at);
            if (evDate.getFullYear() === year && evDate.getMonth() === month) {
                const day = evDate.getDate();
                if (ev.type === 'PushEvent') {
                    dayCounts[day] += (ev.payload.commits ? ev.payload.commits.length : 1);
                } else {
                    dayCounts[day] += 1;
                }
            }
        }

        const totalContributions = Object.values(dayCounts).reduce((a, b) => a + b, 0);
        const maxCount = Math.max(...Object.values(dayCounts), 1);

        // Build the chart
        const firstDay = new Date(year, month, 1).getDay(); // 0=Sunday
        const dayLabels = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];

        let html = `
            <div class="contribution-header">
                <span class="contribution-count"><strong>${totalContributions}</strong> contributions in ${monthName} ${year}</span>
            </div>
            <div class="contribution-grid-wrapper">
                <div class="contribution-day-labels">
                    ${dayLabels.map(d => `<span>${d}</span>`).join('')}
                </div>
                <div class="contribution-grid">
        `;

        // Add empty cells for offset
        for (let i = 0; i < firstDay; i++) {
            html += '<div class="contribution-cell empty"></div>';
        }

        // Add day cells
        for (let d = 1; d <= daysInMonth; d++) {
            const count = dayCounts[d];
            let level = 0;
            if (count > 0) level = 1;
            if (count >= 3) level = 2;
            if (count >= 6) level = 3;
            if (count >= 10) level = 4;

            const isToday = d === now.getDate();
            html += `<div class="contribution-cell level-${level}${isToday ? ' today' : ''}" title="${monthName} ${d}: ${count} contribution${count !== 1 ? 's' : ''}"><span class="cell-day">${d}</span></div>`;
        }

        html += `
                </div>
            </div>
            <div class="contribution-legend">
                <span>Less</span>
                <div class="contribution-cell level-0 legend-cell"></div>
                <div class="contribution-cell level-1 legend-cell"></div>
                <div class="contribution-cell level-2 legend-cell"></div>
                <div class="contribution-cell level-3 legend-cell"></div>
                <div class="contribution-cell level-4 legend-cell"></div>
                <span>More</span>
            </div>
        `;

        chartEl.innerHTML = html;

    } catch (err) {
        chartEl.innerHTML = '<p class="activity-empty">Unable to load contribution data.</p>';
    }
}

// Initialize
document.addEventListener('DOMContentLoaded', () => {
    animateNumbers();
    initScrollAnimations();
    loadGitHubActivity();
    loadContributionChart();
});
</script>
{{ end }}
