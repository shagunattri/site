{{- /* Head partial - Modularized SEO */}}

{{- /* SEO Meta tags (title, description, OG, Twitter) */}}
{{ partial "seo/meta.html" . }}

<!-- Fonts - Preload Inter as primary font -->
<link rel="preload" href="/fonts/Inter-Regular.woff2" as="font" type="font/woff2" crossorigin>

<!-- Google CSS Styles for Flex Fonts - Local Hosting -->
<style>
  @font-face {
    font-family: 'Google Sans Flex';
    font-style: normal;
    font-weight: 400 700;
    font-display: swap;
    src: url('/fonts/GoogleSansFlex.woff2') format('woff2');
    unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+0304, U+0308, U+0329, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
  }
</style>

<!-- CSS -->
{{ $options := (dict "targetPath" "main.css" "outputStyle" "compressed" "enableSourceMap" true) }}
{{ $style := resources.Get "scss/main.scss" | resources.ToCSS $options | resources.Fingerprint }}
<link rel="stylesheet" href="{{ $style.RelPermalink }}" integrity="{{ $style.Data.Integrity }}">

{{ range $val := $.Site.Params.customCSS }}
    {{ if gt (len $val) 0 }}
        <link rel="stylesheet" type="text/css" href="{{ $val }}">
    {{ end }}
{{ end }}

<!-- Icons -->
{{- partial "favicons.html" . }}

{{ if isset .Site.Taxonomies "series" }}
    {{ template "_internal/opengraph.html" . }}
{{ end }}

<!-- RSS -->
{{ with .OutputFormats.Get "rss" -}}
    {{ printf `<link rel="%s" type="%s" href="%s" title="%s" />` .Rel .MediaType.Type .Permalink $.Site.Title | safeHTML }}
{{ end -}}

<!-- JSON Feed -->
{{ if .OutputFormats.Get "json" }}
<link href="{{ if .OutputFormats.Get "json" }}{{ .Site.BaseURL }}feed.json{{ end }}" rel="alternate"
    type="application/json" title="{{ .Site.Title }}" />
{{ end }}

<!-- Custom head tags -->
{{- if templates.Exists "partials/extra-head.html" -}}
    {{ partial "extra-head.html" . }}
{{- end }}

<!-- Plausible.io -->
{{- if $.Site.Params.plausibleDataDomain }}
    <script defer data-domain="{{ .Site.Params.plausibleDataDomain }}" src="{{ .Site.Params.plausibleScriptSource }}"></script>
{{- end}}

{{- /* Schema.org JSON-LD */}}
{{- if .IsHome -}}
    {{- /* Homepage schemas */}}
    {{ partial "seo/schema-organization.html" . }}
    {{ partial "seo/schema-website.html" . }}
    {{ partial "seo/schema-person.html" . }}
{{- else -}}
    {{- /* Non-homepage schemas */}}
    {{ partial "seo/schema-breadcrumb.html" . }}
    {{ partial "seo/schema-article.html" . }}
    {{ partial "seo/schema-faq.html" . }}
{{- end -}}

<!-- Netlify Identity Widget for CMS Authentication -->
<script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
<script>
  if (window.netlifyIdentity) {
    window.netlifyIdentity.on("init", user => {
      if (!user) {
        window.netlifyIdentity.on("login", () => {
          document.location.href = "/admin/";
        });
      }
    });
  }
</script>
